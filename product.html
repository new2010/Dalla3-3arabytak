<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชูุงุตูู ุงูููุชุฌ - ุฏูุน ุนุฑุจูุชู</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav">
                <div class="logo">
                    <h1>๐ ุฏูุน ุนุฑุจูุชู</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html">ุงูุฑุฆูุณูุฉ</a>
                    <a href="cart.html" class="cart-link">
                        <span class="cart-icon">๐</span>
                        ุงูุณูุฉ <span id="cartCount" class="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">ุงูุฑุฆูุณูุฉ</a>
            <span>/</span>
            <span id="breadcrumbCategory">ุงูููุชุฌุงุช</span>
            <span>/</span>
            <span id="breadcrumbProduct">ุชูุงุตูู ุงูููุชุฌ</span>
        </div>
    </div>

    <!-- Product Details -->
    <section class="product-details">
        <div class="container">
            <div id="loadingSpinner" class="loading">
                <div class="spinner"></div>
                <p>ุฌุงุฑู ุชุญููู ุชูุงุตูู ุงูููุชุฌ...</p>
            </div>
            
            <div id="productContent" class="product-content" style="display: none;">
                <div class="product-image-section">
                    <div class="main-image">
                        <div id="productImage" class="image-placeholder">
                            <p id="imageDescription">ุตูุฑุฉ ุงูููุชุฌ</p>
                        </div>
                    </div>
                </div>
                
                <div class="product-info-section">
                    <div class="product-header">
                        <h1 id="productName">ุงุณู ุงูููุชุฌ</h1>
                        <div class="product-meta">
                            <span id="productCategory" class="category-badge">ุงููุฆุฉ</span>
                            <div class="product-tags" id="productTags"></div>
                        </div>
                    </div>
                    
                    <div class="price-section">
                        <div id="productPrice" class="price">0 ุฌููู</div>
                        <div id="stockStatus" class="stock-status">ูุชููุฑ ูู ุงููุฎุฒู</div>
                    </div>
                    
                    <div class="description-section">
                        <h3>ูุตู ุงูููุชุฌ</h3>
                        <p id="productShortDesc" class="short-description"></p>
                        <div id="productLongDesc" class="long-description"></div>
                    </div>
                    
                    <div class="add-to-cart-section">
                        <div class="quantity-selector">
                            <label for="quantity">ุงููููุฉ:</label>
                            <div class="quantity-controls">
                                <button type="button" onclick="changeQuantity(-1)">-</button>
                                <input type="number" id="quantity" value="1" min="1" max="10">
                                <button type="button" onclick="changeQuantity(1)">+</button>
                            </div>
                        </div>
                        
                        <button id="addToCartBtn" class="btn btn-primary btn-large" onclick="addProductToCart()">
                            ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ
                        </button>
                        
                        <button class="btn btn-secondary btn-large" onclick="buyNow()">
                            ุงุดุชุฑ ุงูุขู
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="productNotFound" class="not-found" style="display: none;">
                <h2>ุงูููุชุฌ ุบูุฑ ููุฌูุฏ</h2>
                <p>ุนุฐุฑุงูุ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุชุฌ ุงููุทููุจ</p>
                <a href="index.html" class="btn btn-primary">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    <section class="related-products">
        <div class="container">
            <h2 class="section-title">ููุชุฌุงุช ุฐุงุช ุตูุฉ</h2>
            <div id="relatedGrid" class="products-grid"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ุฏูุน ุนุฑุจูุชู</h3>
                    <p>ุฃูุถู ูุชุฌุฑ ูุฅูุณุณูุงุฑุงุช ุงูุณูุงุฑุงุช ูู ูุตุฑ</p>
                </div>
                <div class="footer-section">
                    <h4>ุฑูุงุจุท ุณุฑูุนุฉ</h4>
                    <ul>
                        <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
                        <li><a href="cart.html">ุงูุณูุฉ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>ุชูุงุตู ูุนูุง</h4>
                    <p>๐ 01234567890</p>
                    <p>๐ง info@dalewcarabitak.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ุฏูุน ุนุฑุจูุชู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
            </div>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="toast" class="toast"></div>

    <script src="config.js"></script>
    <script src="assets/app.js"></script>
    <script>
        let currentProduct = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            const productId = getProductIdFromURL();
            if (productId) {
                loadProduct(productId);
            } else {
                showProductNotFound();
            }
        });

        // Get product ID from URL parameters
        function getProductIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Load product details from API
        async function loadProduct(productId) {
            try {
                showSpinner(true);
                const response = await fetch(`${API_BASE}?action=product&id=${productId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const product = await response.json();
                
                if (product && product.id) {
                    currentProduct = product;
                    displayProduct(product);
                    loadRelatedProducts(product.category);
                } else {
                    showProductNotFound();
                }
            } catch (error) {
                console.error('Error loading product:', error);
                showToast('ูุดู ูู ุชุญููู ุงูููุชุฌ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.', 'error');
                showProductNotFound();
            } finally {
                showSpinner(false);
            }
        }

        // Display product details
        function displayProduct(product) {
            document.getElementById('productContent').style.display = 'flex';
            
            // Update page title and breadcrumb
            document.title = `${product.name} - ุฏูุน ุนุฑุจูุชู`;
            document.getElementById('breadcrumbCategory').textContent = product.category || 'ุงูููุชุฌุงุช';
            document.getElementById('breadcrumbProduct').textContent = product.name;
            
            // Update product information
            document.getElementById('productName').textContent = product.name;
            document.getElementById('imageDescription').textContent = product.image_desc || 'ุตูุฑุฉ ุงูููุชุฌ';
            document.getElementById('productCategory').textContent = product.category || '';
            document.getElementById('productPrice').textContent = `${product.price} ${STORE_CONFIG.currency}`;
            document.getElementById('productShortDesc').textContent = product.short_desc || '';
            document.getElementById('productLongDesc').innerHTML = product.long_desc || '';
            
            // Update stock status
            const stockStatus = document.getElementById('stockStatus');
            if (product.stock && product.stock > 0) {
                stockStatus.textContent = `ูุชููุฑ (${product.stock} ูุทุนุฉ)`;
                stockStatus.className = 'stock-status in-stock';
                document.getElementById('addToCartBtn').disabled = false;
            } else {
                stockStatus.textContent = 'ุบูุฑ ูุชููุฑ';
                stockStatus.className = 'stock-status out-of-stock';
                document.getElementById('addToCartBtn').disabled = true;
            }
            
            // Update tags
            const tagsContainer = document.getElementById('productTags');
            if (product.tags) {
                const tags = product.tags.split(',').map(tag => tag.trim()).filter(Boolean);
                tagsContainer.innerHTML = tags.map(tag => 
                    `<span class="tag">${tag}</span>`
                ).join('');
            }
            
            // Update quantity limits
            const quantityInput = document.getElementById('quantity');
            quantityInput.max = Math.min(product.stock || 10, 10);
        }

        // Load related products
        async function loadRelatedProducts(category) {
            try {
                const response = await fetch(`${API_BASE}?action=products`);
                const allProducts = await response.json();
                
                const related = allProducts
                    .filter(p => p.category === category && p.id !== currentProduct.id)
                    .slice(0, 4);
                
                if (related.length > 0) {
                    displayRelatedProducts(related);
                } else {
                    document.querySelector('.related-products').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading related products:', error);
                document.querySelector('.related-products').style.display = 'none';
            }
        }

        // Display related products
        function displayRelatedProducts(products) {
            const container = document.getElementById('relatedGrid');
            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        <div class="image-placeholder">
                            <p>${product.image_desc || 'ุตูุฑุฉ ุงูููุชุฌ'}</p>
                        </div>
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-desc">${product.short_desc || ''}</p>
                        <div class="product-price">${product.price} ${STORE_CONFIG.currency}</div>
                        <button onclick="window.location.href='product.html?id=${product.id}'" class="btn btn-primary">
                            ุนุฑุถ ุงูุชูุงุตูู
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Change quantity
        function changeQuantity(delta) {
            const quantityInput = document.getElementById('quantity');
            const currentValue = parseInt(quantityInput.value);
            const newValue = currentValue + delta;
            const maxValue = parseInt(quantityInput.max);
            
            if (newValue >= 1 && newValue <= maxValue) {
                quantityInput.value = newValue;
            }
        }

        // Add product to cart
        function addProductToCart() {
            if (!currentProduct) return;
            
            const quantity = parseInt(document.getElementById('quantity').value);
            
            addToCart({
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                quantity: quantity
            });
        }

        // Buy now (add to cart and go to checkout)
        function buyNow() {
            addProductToCart();
            setTimeout(() => {
                window.location.href = 'cart.html';
            }, 500);
        }

        // Show product not found
        function showProductNotFound() {
            document.getElementById('productContent').style.display = 'none';
            document.getElementById('productNotFound').style.display = 'block';
        }

        // Show loading spinner
        function showSpinner(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'flex' : 'none';
        }
    </script>
</body>
</html>