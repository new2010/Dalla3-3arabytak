<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دلع عربيتك - متجر إكسسوارات السيارات</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="أفضل متجر لإكسسوارات السيارات في مصر - دلع عربيتك">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav">
                <div class="logo">
                    <h1>🚗 دلع عربيتك</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html" class="active">الرئيسية</a>
                    <a href="cart.html" class="cart-link">
                        <span class="cart-icon">🛒</span>
                        السلة <span id="cartCount" class="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h2>دلع عربيتك بأفضل الإكسسوارات</h2>
                <p>مجموعة متنوعة من إكسسوارات السيارات عالية الجودة</p>
            </div>
        </div>
    </section>

    <!-- Search and Filter -->
    <section class="filters">
        <div class="container">
            <div class="filter-bar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ابحث عن المنتجات...">
                    <button id="searchBtn">🔍</button>
                </div>
                <div class="filter-options">
                    <select id="categoryFilter">
                        <option value="">جميع الفئات</option>
                    </select>
                    <select id="priceFilter">
                        <option value="">جميع الأسعار</option>
                        <option value="0-100">أقل من 100 جنيه</option>
                        <option value="100-300">100 - 300 جنيه</option>
                        <option value="300-500">300 - 500 جنيه</option>
                        <option value="500+">أكثر من 500 جنيه</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products">
        <div class="container">
            <h2 class="section-title">منتجاتنا المميزة</h2>
            <div id="loadingSpinner" class="loading">
                <div class="spinner"></div>
                <p>جاري تحميل المنتجات...</p>
            </div>
            <div id="productsGrid" class="products-grid"></div>
            <div id="noProducts" class="no-products" style="display: none;">
                <p>لم يتم العثور على منتجات مطابقة للبحث</p>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="featured">
        <div class="container">
            <h2 class="section-title">المنتجات المميزة</h2>
            <div id="featuredGrid" class="products-grid"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>دلع عربيتك</h3>
                    <p>أفضل متجر لإكسسوارات السيارات في مصر</p>
                </div>
                <div class="footer-section">
                    <h4>روابط سريعة</h4>
                    <ul>
                        <li><a href="index.html">الرئيسية</a></li>
                        <li><a href="cart.html">السلة</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>تواصل معنا</h4>
                    <p>📞 01234567890</p>
                    <p>📧 info@dalewcarabitak.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 دلع عربيتك. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="toast" class="toast"></div>

    <script src="config.js"></script>
    <script src="assets/app.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            loadProducts();
            initializeFilters();
        });

        // Load products from API
        async function loadProducts() {
            try {
                showSpinner(true);
                const response = await fetch(`${API_BASE}?action=products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const products = await response.json();
                displayProducts(products);
                displayFeaturedProducts(products);
                populateCategoryFilter(products);
            } catch (error) {
                console.error('Error loading products:', error);
                showToast('فشل في تحميل المنتجات. يرجى المحاولة مرة أخرى.', 'error');
            } finally {
                showSpinner(false);
            }
        }

        // Display products in grid
        function displayProducts(products, containerId = 'productsGrid') {
            const container = document.getElementById(containerId);
            
            if (!products || products.length === 0) {
                document.getElementById('noProducts').style.display = 'block';
                container.innerHTML = '';
                return;
            }
            
            document.getElementById('noProducts').style.display = 'none';
            
            container.innerHTML = products.map(product => `
                <div class="product-card" data-category="${product.category}" data-price="${product.price}">
                    <div class="product-image">
                        <div class="image-placeholder">
                            <p>${product.image_desc || 'صورة المنتج'}</p>
                        </div>
                        ${product.featured ? '<span class="featured-badge">مميز</span>' : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">${product.name}</h3>
                        <p class="product-desc">${product.short_desc || ''}</p>
                        <div class="product-price">${product.price} ${STORE_CONFIG.currency}</div>
                        <div class="product-actions">
                            <button onclick="viewProduct('${product.id}')" class="btn btn-primary">
                                عرض التفاصيل
                            </button>
                            <button onclick="quickAddToCart('${product.id}', '${product.name}', ${product.price})" 
                                    class="btn btn-secondary">
                                إضافة للسلة
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display featured products
        function displayFeaturedProducts(products) {
            const featured = products.filter(p => p.featured);
            if (featured.length > 0) {
                displayProducts(featured, 'featuredGrid');
            } else {
                document.querySelector('.featured').style.display = 'none';
            }
        }

        // Populate category filter
        function populateCategoryFilter(products) {
            const categories = [...new Set(products.map(p => p.category))].filter(Boolean);
            const categoryFilter = document.getElementById('categoryFilter');
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // Initialize search and filters
        function initializeFilters() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const categoryFilter = document.getElementById('categoryFilter');
            const priceFilter = document.getElementById('priceFilter');

            // Search functionality
            searchBtn.addEventListener('click', filterProducts);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    filterProducts();
                }
            });

            // Filter functionality
            categoryFilter.addEventListener('change', filterProducts);
            priceFilter.addEventListener('change', filterProducts);
        }

        // Filter products based on search and filters
        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priceFilter = document.getElementById('priceFilter').value;
            
            const productCards = document.querySelectorAll('.product-card');
            let visibleCount = 0;

            productCards.forEach(card => {
                const productName = card.querySelector('.product-name').textContent.toLowerCase();
                const productDesc = card.querySelector('.product-desc').textContent.toLowerCase();
                const productCategory = card.dataset.category;
                const productPrice = parseFloat(card.dataset.price);

                let show = true;

                // Search filter
                if (searchTerm && !productName.includes(searchTerm) && !productDesc.includes(searchTerm)) {
                    show = false;
                }

                // Category filter
                if (categoryFilter && productCategory !== categoryFilter) {
                    show = false;
                }

                // Price filter
                if (priceFilter) {
                    const [min, max] = priceFilter.split('-');
                    if (max === undefined && productPrice <= parseFloat(min)) {
                        show = false;
                    } else if (max && (productPrice < parseFloat(min) || productPrice > parseFloat(max))) {
                        show = false;
                    }
                }

                card.style.display = show ? 'block' : 'none';
                if (show) visibleCount++;
            });

            document.getElementById('noProducts').style.display = visibleCount === 0 ? 'block' : 'none';
        }

        // Quick add to cart
        function quickAddToCart(productId, productName, productPrice) {
            addToCart({
                id: productId,
                name: productName,
                price: productPrice,
                quantity: 1
            });
        }

        // View product details
        function viewProduct(productId) {
            window.location.href = `product.html?id=${productId}`;
        }

        // Show loading spinner
        function showSpinner(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'flex' : 'none';
        }
    </script>
</body>
</html>