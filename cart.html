<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª - Ø¯Ù„Ø¹ Ø¹Ø±Ø¨ÙŠØªÙƒ</title>
    <link rel="stylesheet" href="assets/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav">
                <div class="logo">
                    <h1>ğŸš— Ø¯Ù„Ø¹ Ø¹Ø±Ø¨ÙŠØªÙƒ</h1>
                </div>
                <div class="nav-links">
                    <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="cart.html" class="cart-link active">
                        <span class="cart-icon">ğŸ›’</span>
                        Ø§Ù„Ø³Ù„Ø© <span id="cartCount" class="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <span>/</span>
            <span>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
        </div>
    </div>

    <!-- Cart Section -->
    <section class="cart-section">
        <div class="container">
            <h1 class="page-title">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>
            
            <!-- Empty Cart -->
            <div id="emptyCart" class="empty-cart">
                <div class="empty-cart-icon">ğŸ›’</div>
                <h3>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</h3>
                <p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯</p>
                <a href="index.html" class="btn btn-primary">ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
            </div>

            <!-- Cart Items -->
            <div id="cartContent" class="cart-content" style="display: none;">
                <div class="cart-items">
                    <div class="cart-header">
                        <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>
                        <button id="clearCartBtn" class="btn btn-danger" onclick="clearCart()">
                            Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©
                        </button>
                    </div>
                    <div id="cartItemsList" class="cart-items-list"></div>
                </div>

                <!-- Order Summary -->
                <div class="order-summary">
                    <div class="summary-card">
                        <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
                        <div class="summary-line">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                            <span id="subtotal">0 Ø¬Ù†ÙŠÙ‡</span>
                        </div>
                        <div class="summary-line">
                            <span>Ø§Ù„Ø´Ø­Ù†:</span>
                            <span id="shippingCost">50 Ø¬Ù†ÙŠÙ‡</span>
                        </div>
                        <div class="summary-line discount" id="discountLine" style="display: none;">
                            <span>Ø®ØµÙ… Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ:</span>
                            <span id="discount">-50 Ø¬Ù†ÙŠÙ‡</span>
                        </div>
                        <hr>
                        <div class="summary-line total">
                            <span><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong></span>
                            <span id="total"><strong>0 Ø¬Ù†ÙŠÙ‡</strong></span>
                        </div>
                        <p class="free-shipping-notice" id="freeShippingNotice"></p>
                    </div>
                </div>

                <!-- Checkout Form -->
                <div class="checkout-section">
                    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
                    <form id="checkoutForm" class="checkout-form">
                        <div class="form-group">
                            <label for="customerName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                            <input type="text" id="customerName" name="customerName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                            <input type="tel" id="phone" name="phone" required 
                                   pattern="01[0-9]{9}" placeholder="01xxxxxxxxx">
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                            <textarea id="address" name="address" required rows="3" 
                                    placeholder="Ø§Ù„Ø´Ø§Ø±Ø¹ - Ø§Ù„Ù…Ù†Ø·Ù‚Ø© - Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="shippingType">Ù†ÙˆØ¹ Ø§Ù„Ø´Ø­Ù†</label>
                            <select id="shippingType" name="shippingType">
                                <option value="standard">Ø´Ø­Ù† Ø¹Ø§Ø¯ÙŠ (2-3 Ø£ÙŠØ§Ù…) - 50 Ø¬Ù†ÙŠÙ‡</option>
                                <option value="express">Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ (24 Ø³Ø§Ø¹Ø©) - 100 Ø¬Ù†ÙŠÙ‡</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <textarea id="notes" name="notes" rows="2" 
                                    placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ù„Ø¨..."></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-large" id="submitOrderBtn">
                                <span id="submitBtnText">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</span>
                                <span id="submitBtnSpinner" class="btn-spinner" style="display: none;">â³</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Success -->
            <div id="orderSuccess" class="order-success" style="display: none;">
                <div class="success-icon">âœ…</div>
                <h3>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                <p>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <strong id="orderNumber"></strong></p>
                <p>Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p>
                <div class="success-actions">
                    <a href="index.html" class="btn btn-primary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚</a>
                    <button onclick="printOrderDetails()" class="btn btn-secondary">Ø·Ø¨Ø§Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Ø¯Ù„Ø¹ Ø¹Ø±Ø¨ÙŠØªÙƒ</h3>
                    <p>Ø£ÙØ¶Ù„ Ù…ØªØ¬Ø± Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ÙÙŠ Ù…ØµØ±</p>
                </div>
                <div class="footer-section">
                    <h4>Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h4>
                    <ul>
                        <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li><a href="cart.html">Ø§Ù„Ø³Ù„Ø©</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
                    <p>ğŸ“ 01234567890</p>
                    <p>ğŸ“§ info@dalewcarabitak.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Ø¯Ù„Ø¹ Ø¹Ø±Ø¨ÙŠØªÙƒ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="toast" class="toast"></div>

    <script src="config.js"></script>
    <script src="assets/app.js"></script>
    <script>
        let cartItems = [];
        let lastOrderId = '';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCart();
            updateCartDisplay();
            initializeCheckoutForm();
        });

        // Load cart from localStorage
        function loadCart() {
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                try {
                    cartItems = JSON.parse(savedCart);
                } catch (error) {
                    console.error('Error parsing cart data:', error);
                    cartItems = [];
                }
            }
            updateCartCount();
        }

        // Update cart display
        function updateCartDisplay() {
            if (cartItems.length === 0) {
                document.getElementById('emptyCart').style.display = 'block';
                document.getElementById('cartContent').style.display = 'none';
                return;
            }

            document.getElementById('emptyCart').style.display = 'none';
            document.getElementById('cartContent').style.display = 'block';
            
            displayCartItems();
            updateOrderSummary();
        }

        // Display cart items
        function displayCartItems() {
            const container = document.getElementById('cartItemsList');
            
            container.innerHTML = cartItems.map((item, index) => `
                <div class="cart-item" data-index="${index}">
                    <div class="item-info">
                        <h4 class="item-name">${item.name}</h4>
                        <p class="item-price">${item.price} ${STORE_CONFIG.currency}</p>
                    </div>
                    <div class="quantity-controls">
                        <button onclick="updateItemQuantity(${index}, -1)">-</button>
                        <span class="quantity">${item.quantity}</span>
                        <button onclick="updateItemQuantity(${index}, 1)">+</button>
                    </div>
                    <div class="item-total">
                        ${item.price * item.quantity} ${STORE_CONFIG.currency}
                    </div>
                    <button class="remove-item" onclick="removeItem(${index})">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        // Update item quantity
        function updateItemQuantity(index, delta) {
            if (cartItems[index]) {
                const newQuantity = cartItems[index].quantity + delta;
                if (newQuantity <= 0) {
                    removeItem(index);
                } else if (newQuantity <= 10) {
                    cartItems[index].quantity = newQuantity;
                    saveCart();
                    updateCartDisplay();
                }
            }
        }

        // Remove item from cart
        function removeItem(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ')) {
                cartItems.splice(index, 1);
                saveCart();
                updateCartDisplay();
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©');
            }
        }

        // Clear entire cart
        function clearCart() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
                cartItems = [];
                saveCart();
                updateCartDisplay();
                showToast('ØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©');
            }
        }

        // Update order summary
        function updateOrderSummary() {
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shippingType = document.getElementById('shippingType').value;
            let shippingCost = shippingType === 'express' ? 100 : STORE_CONFIG.shippingCost;
            
            // Free shipping for orders above threshold
            const isFreeShipping = subtotal >= STORE_CONFIG.freeShippingThreshold;
            if (isFreeShipping && shippingType === 'standard') {
                shippingCost = 0;
            }
            
            const total = subtotal + shippingCost;
            
            // Update display
            document.getElementById('subtotal').textContent = `${subtotal} ${STORE_CONFIG.currency}`;
            document.getElementById('shippingCost').textContent = `${shippingCost} ${STORE_CONFIG.currency}`;
            document.getElementById('total').querySelector('strong').textContent = `${total} ${STORE_CONFIG.currency}`;
            
            // Show/hide discount line
            const discountLine = document.getElementById('discountLine');
            if (isFreeShipping && shippingType === 'standard' && subtotal >= STORE_CONFIG.freeShippingThreshold) {
                discountLine.style.display = 'flex';
                document.getElementById('discount').textContent = `-${STORE_CONFIG.shippingCost} ${STORE_CONFIG.currency}`;
            } else {
                discountLine.style.display = 'none';
            }
            
            // Update free shipping notice
            const freeShippingNotice = document.getElementById('freeShippingNotice');
            if (subtotal < STORE_CONFIG.freeShippingThreshold) {
                const remaining = STORE_CONFIG.freeShippingThreshold - subtotal;
                freeShippingNotice.textContent = `Ø£Ø¶Ù ${remaining} ${STORE_CONFIG.currency} Ø£Ø®Ø±Ù‰ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ!`;
                freeShippingNotice.style.display = 'block';
            } else {
                freeShippingNotice.textContent = 'ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ';
                freeShippingNotice.style.display = 'block';
            }
        }

        // Initialize checkout form
        function initializeCheckoutForm() {
            const form = document.getElementById('checkoutForm');
            const shippingSelect = document.getElementById('shippingType');
            
            // Update shipping cost when selection changes
            shippingSelect.addEventListener('change', updateOrderSummary);
            
            // Handle form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (cartItems.length === 0) {
                    showToast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'error');
                    return;
                }
                
                const formData = new FormData(form);
                const orderData = {
                    customer_name: formData.get('customerName'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    shipping_type: formData.get('shippingType'),
                    notes: formData.get('notes') || '',
                    items: cartItems.map(item => ({
                        product_id: item.id,
                        name: item.name,
                        price: item.price,
                        qty: item.quantity
                    }))
                };
                
                // Calculate totals
                const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                let shippingCost = orderData.shipping_type === 'express' ? 100 : STORE_CONFIG.shippingCost;
                
                if (subtotal >= STORE_CONFIG.freeShippingThreshold && orderData.shipping_type === 'standard') {
                    shippingCost = 0;
                }
                
                orderData.subtotal = subtotal;
                orderData.shipping = shippingCost;
                orderData.total = subtotal + shippingCost;
                
                await submitOrder(orderData);
            });
        }

        // Submit order to API
        async function submitOrder(orderData) {
            const submitBtn = document.getElementById('submitOrderBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            const submitBtnSpinner = document.getElementById('submitBtnSpinner');
            
            try {
                // Show loading state
                submitBtn.disabled = true;
                submitBtnText.style.display = 'none';
                submitBtnSpinner.style.display = 'inline';
                
                const response = await fetch(`${API_BASE}?action=order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                
                const result = await response.json();
                
                if (result.success && result.order_id) {
                    // Clear cart and show success
                    cartItems = [];
                    saveCart();
                    lastOrderId = result.order_id;
                    showOrderSuccess(result.order_id);
                } else {
                    throw new Error(result.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
                }
                
            } catch (error) {
                console.error('Error submitting order:', error);
                showToast('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtnText.style.display = 'inline';
                submitBtnSpinner.style.display = 'none';
            }
        }

        // Show order success message
        function showOrderSuccess(orderId) {
            document.getElementById('cartContent').style.display = 'none';
            document.getElementById('emptyCart').style.display = 'none';
            document.getElementById('orderSuccess').style.display = 'block';
            document.getElementById('orderNumber').textContent = orderId;
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Print order details
        function printOrderDetails() {
            window.print();
        }

        // Save cart to localStorage
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cartItems));
            updateCartCount();
        }
    </script>
</body>
</html>